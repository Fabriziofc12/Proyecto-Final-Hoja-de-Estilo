<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SmartAcademy - Cursos</title>

  <!-- Tailwind global -->
  <link rel="stylesheet" href="/css/output.css" />
  <!-- Estilos específicos de Cursos -->
  <link rel="stylesheet" href="/css/cursos.css" />
</head>

<body class="cursos-page">
  <main>
    <div th:replace="fragments/header :: header"></div>

    <!-- Encabezado -->
    <section class="cursos-page">
      <div class="hero">
        <div class="hero-content">
          <div class="hero-text">
            <h1>Cursos</h1>
            <p>Explora nuestros cursos en línea y mejora tus habilidades. Filtra, aprende y alcanza tus metas.</p>
          </div>
          <div class="hero-search">
           <!-- Buscador: ponlo donde necesites (hero o encima de la lista) -->
            <form id="searchForm" class="mb-6 max-w-6xl mx-auto px-6" onsubmit="return false;">
              <div class="flex gap-3 justify-end">
                <input id="searchInput" type="search" placeholder="Buscar por título o descripción..."
                      class="w-full md:w-80 px-4 py-2 rounded-lg border border-gray-300 focus:outline-none" />
                <button id="searchBtn" type="button"
                        class="px-4 py-2 rounded-lg bg-emerald-600 text-white font-semibold hover:bg-emerald-700">
                  Buscar
                </button>
              </div>
            </form>

          </div>
        </div>
      </div>
    </section>

    <!-- Lista de Cursos -->
    <section class="py-12">
      <div class="max-w-6xl mx-auto px-6 grid gap-8 sm:grid-cols-2 lg:grid-cols-3" id="coursesGrid">
        <div th:each="curso : ${cursos}"
            class="curso-card bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition"
            th:attr="data-title=${curso.titulo}, data-desc=${curso.descripcion}">
          <a th:href="@{'/Cursos/' + ${curso.id}}">
            <img th:src="${curso.imagen}" alt="Imagen curso" class="w-full h-48 object-cover" />
            <div class="p-6">
              <h2 class="text-xl font-semibold text-emerald-600" th:text="${curso.titulo}">Título</h2>
              <p class="text-gray-600 mt-2" >Nombre Instructor</p>
              <p class="text-gray-700 mt-4" >Nivel del curso</p>
            </div>
          </a>
        </div>
      </div>

      <!-- Mensaje de "no resultados" -->
      <div id="noResults" class="max-w-6xl mx-auto px-6 mt-6 text-center text-gray-400 hidden">
        No se encontraron cursos que coincidan con la búsqueda.
      </div>
    </section>

  </main>
  
  <script>
  // --- seguridad: comprobar que el DOM esté listo (ya estamos al final del body, pero por si acaso) ---
  (function () {

    // --- MENU MOVIL (seguro) ---
    const menuBtn = document.getElementById('menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    if (menuBtn && mobileMenu) {
      menuBtn.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
    } else {
      // no mostrar error si no existen (fragment header puede no tenerlos)
      console.debug('menu-btn o mobile-menu no encontrados (esto puede ser normal en algunas vistas).');
    }

    // --- ELEMENTOS DEL BUSCADOR ---
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const noResultsEl = document.getElementById('noResults');

    // selector flexible para las tarjetas (asegúrate que la clase .curso-card esté presente en cada tarjeta)
    const getCourseCards = () => document.querySelectorAll('.curso-card');

    function normalizeText(s) {
      return (s || '').toString().normalize('NFD').replace(/[\u0300-\u036f]/g, '').trim().toLowerCase();
      // normalizamos acentos para búsquedas más amigables
    }

    function filterCourses(query) {
      const q = normalizeText(query);
      const cards = getCourseCards();
      if (!cards || cards.length === 0) {
        console.debug('No se encontraron tarjetas de curso (query: "' + q + '"). Revisa que Thymeleaf esté renderizando ${cursos}.');
        if (noResultsEl) noResultsEl.classList.remove('hidden');
        return;
      }

      let anyVisible = false;
      cards.forEach(card => {
        const title = normalizeText(card.getAttribute('data-title') || (card.querySelector('h2') ? card.querySelector('h2').textContent : ''));
        const desc  = normalizeText(card.getAttribute('data-desc')  || (card.querySelector('p')  ? card.querySelector('p').textContent  : ''));

        const match = q === '' || title.includes(q) || desc.includes(q);
        card.style.display = match ? '' : 'none';
        if (match) anyVisible = true;
      });

      // Mensaje de "no resultados"
      if (noResultsEl) {
        if (!anyVisible) {
          noResultsEl.classList.remove('hidden');
        } else {
          noResultsEl.classList.add('hidden');
        }
      }
    }

    // Si no existen los elementos de búsqueda, salir limpiamente
    if (!searchInput && !searchBtn) {
      console.debug('SearchInput y SearchBtn no encontrados — el buscador no se inicializa.');
      return;
    }

    // Si existe input: filtrar al teclear (UX en tiempo real)
    if (searchInput) {
      searchInput.addEventListener('input', (e) => {
        filterCourses(e.target.value);
      });
    } else {
      console.debug('searchInput no encontrado — búsqueda en tiempo real desactivada.');
    }

    // Si existe botón: filtrar al hacer click
    if (searchBtn) {
      searchBtn.addEventListener('click', () => {
        filterCourses(searchInput ? searchInput.value : '');
      });
    } else {
      console.debug('searchBtn no encontrado — búsqueda por botón desactivada.');
    }

    // Si la página recibe ?q=texto en la URL, aplicarlo automáticamente
    window.addEventListener('load', () => {
      try {
        const params = new URLSearchParams(window.location.search);
        const q = params.get('q');
        if (q && (searchInput || searchBtn)) {
          if (searchInput) searchInput.value = q;
          filterCourses(q);
        }
      } catch (err) {
        console.warn('No se pudo leer query string:', err);
      }
    });

    // Para depuración: si algo no funciona, abre la consola (F12) y revisa los mensajes.
    console.debug('Buscador inicializado. Cartas encontradas:', getCourseCards().length);
  })();
</script>

</body>

</html>
